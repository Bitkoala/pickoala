# 1Panel éƒ¨ç½²æŒ‡å— (å®¹å™¨åŒ–éƒ¨ç½²)

1Panel æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„è¿ç»´é¢æ¿ï¼Œå®ƒçš„æ ¸å¿ƒå“²å­¦æ˜¯ **Docker å®¹å™¨åŒ–**ã€‚
è™½ç„¶ä½ å¯ä»¥åƒå®å¡”é‚£æ ·æ‰‹åŠ¨è·‘å‘½ä»¤éƒ¨ç½² (Systemd)ï¼Œä½† **å¼ºçƒˆå»ºè®®ä½¿ç”¨ Docker**ï¼Œè¿™ä¼šè®©ä½ çš„ç»´æŠ¤å·¥ä½œå‡å°‘ 90%ã€‚

---

## æ–¹å¼ä¸€ï¼šDocker ä¸€é”®éƒ¨ç½² (æ¨è ğŸ”¥)

è¿™ç§æ–¹å¼æœ€ç®€å•ï¼Œä¸éœ€è¦é…ç½®ç¯å¢ƒï¼Œä¸éœ€è¦ç®¡ä¾èµ–å†²çªã€‚

### 1. å‡†å¤‡ä»£ç  (å…³é”®æ­¥éª¤)
1. ç¡®ä¿ 1Panel å·²å®‰è£… **OpenResty**ã€‚
2. **ä¸Šä¼ ä»£ç **ï¼šè¯·å°†æœ¬åœ°é¡¹ç›®æ–‡ä»¶å¤¹å®Œæ•´ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„ `/opt/pickoala` ç›®å½•ã€‚
   *   **å¿…é¡»åŒ…å«**ï¼š`backend` (åç«¯æºç ), `database` (åˆå§‹åŒ–SQL), `docker-compose.yml`ã€‚
   *   *ç¡®ä¿è·¯å¾„å­˜åœ¨ï¼š`/opt/pickoala/backend/Dockerfile`*ã€‚

### 2. éƒ¨ç½²åç«¯ (Service)
1. åœ¨ 1Panel é¢æ¿ -> **å®¹å™¨** -> **ç¼–æ’ (Compose)** -> **åˆ›å»ºç¼–æ’**ã€‚
2. **åç§°**ï¼šå¡« `pickoala`ã€‚
3. **å†…å®¹**ï¼šç›´æ¥å¤åˆ¶é¡¹ç›®é‡Œçš„ `docker-compose.yml`ã€‚
    *   *æç¤ºï¼šä¸ºäº†åŒ¹é…æ­¤å¤„çš„è·¯å¾„ï¼Œä½ å¯èƒ½éœ€è¦ç®€å•ä¿®æ”¹ `docker-compose.yml` é‡Œçš„æ„å»ºè·¯å¾„ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨ç»å¯¹è·¯å¾„ `. context: /opt/pickoala/backend`*ã€‚
    *   **ç¯å¢ƒå˜é‡**ï¼šåªä¿®æ”¹ `DATABASE_URL`ã€`REDIS_URL` å’Œ `APP_SECRET_KEY`ã€‚
    *   **é‡è¦**ï¼šæ‰€æœ‰é«˜çº§é…ç½®ï¼ˆStripe/æ”¯ä»˜å®æ”¯ä»˜ã€é‚®ä»¶ã€äº‘å­˜å‚¨ï¼‰å‡å·²ç§»è‡³**åå°ç®¡ç†é¢æ¿**ï¼Œæ­¤å¤„æ— éœ€é…ç½®ç¯å¢ƒå˜é‡ã€‚
4. ç‚¹å‡» **ç¡®è®¤**ã€‚
    *   1Panel ä¼šè‡ªåŠ¨æ„å»ºé•œåƒå¹¶å¯åŠ¨æœåŠ¡ã€‚
    *   ç­‰å¾…çŠ¶æ€å˜ä¸ºç»¿è‰²çš„ "å·²å¯åŠ¨"ã€‚

### 3. åˆå§‹åŒ–æ•°æ®åº“
å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ç”¨ Docker å¯åŠ¨ï¼ŒMySQL å®¹å™¨å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨è¯»å– `database/init.sql` è¿›è¡Œåˆå§‹åŒ–ã€‚
**é‡è¦**ï¼šæ”¯ä»˜ã€ä¼šå‘˜ç­‰æ‰€æœ‰æ ¸å¿ƒæ•°æ®è¡¨ä¼šåœ¨é¦–æ¬¡å¯åŠ¨æ—¶**è‡ªåŠ¨åˆ›å»º**ï¼Œæ— éœ€æ‰‹åŠ¨è¿è¡Œè„šæœ¬ã€‚

### 4. éƒ¨ç½²å‰ç«¯ (Web)
1. æœ¬åœ°æ‰§è¡Œ `npm run build` æ‰“åŒ…ã€‚
2. 1Panel é¢æ¿ -> **ç½‘ç«™** -> **åˆ›å»ºç½‘ç«™** -> **é™æ€ç½‘ç«™**ã€‚
3. **ä¸»åŸŸå**ï¼šå¡«ä½ çš„åŸŸåã€‚
4. **ä»£å·**ï¼špickoala-webã€‚
5. åˆ›å»ºæˆåŠŸåï¼Œè¿›å…¥ç½‘ç«™ç›®å½•ï¼ŒæŠŠ `dist` æ–‡ä»¶å¤¹é‡Œçš„å†…å®¹ä¸Šä¼ è¿›å»ã€‚

### 5. é…ç½®åå‘ä»£ç† (è¿æ¥å‰åç«¯)
åœ¨ç½‘ç«™è®¾ç½® -> **åå‘ä»£ç†**ï¼š

**è§„åˆ™ 1 (API)**ï¼š
*   **åå­—**ï¼šAPI
*   **è·¯å¾„**ï¼š`/api`
*   **ä»£ç†åœ°å€**ï¼š`http://127.0.0.1:8000` (å¦‚æœ Docker æ”¹äº†ç«¯å£è¿™é‡Œå¯¹åº”æ”¹)

**è§„åˆ™ 2 (å›¾ç‰‡èµ„æº)**ï¼š
*   **åå­—**ï¼šUploads
*   **è·¯å¾„**ï¼š`/uploads`
*   **ä»£ç†åœ°å€**ï¼š`http://127.0.0.1:8000`

### 6. å¿…é…ï¼šNginx/OpenResty é…ç½® (è§£å†³ 404 å’Œä¸Šä¼ é™åˆ¶)
**éå¸¸é‡è¦ï¼** é»˜è®¤é…ç½®ä¼šå¯¼è‡´ Vue é¡µé¢åˆ·æ–°æŠ¥ 404ï¼Œä¸”æ— æ³•ä¸Šä¼ è¶…è¿‡ 1MB çš„å›¾ç‰‡ã€‚
è¯·åœ¨ **ç½‘ç«™è®¾ç½®** -> **é…ç½®æ–‡ä»¶** é‡Œï¼Œä¿®æ”¹ content å¦‚ä¸‹ï¼š

```nginx
server {
    listen 80;
    listen [::]:80;
    server_name YOUR_DOMAIN_NAME; # æ›¿æ¢ä¸ºä½ çš„åŸŸå
    
    # ---å…³é”®ä¿®æ”¹ 1ï¼šå…è®¸ä¸Šä¼ å¤§æ–‡ä»¶ (æ”¯æŒ >2GB)---
    client_max_body_size 2048M;

    root /www/sites/YOUR_DOMAIN_NAME/index; # ä¿æŒé»˜è®¤
    index index.php index.html index.htm;
    
    # æ—¥å¿—è·¯å¾„ä¿æŒé»˜è®¤
    access_log /www/sites/YOUR_DOMAIN_NAME/log/access.log main;
    error_log /www/sites/YOUR_DOMAIN_NAME/log/error.log;

    # ---å…³é”®ä¿®æ”¹ 2ï¼šæ”¯æŒ Vue è·¯ç”± (é˜²æ­¢åˆ·æ–° 404)---
    location / {
        try_files $uri $uri/ /index.html;
    }

    # API ä»£ç† (1Panel è‡ªåŠ¨ç”Ÿæˆçš„ä¸è¦åˆ )
    include /www/sites/YOUR_DOMAIN_NAME/proxy/*.conf;

    # å®‰å…¨é…ç½® (ä¿æŒé»˜è®¤)
    location ~ ^/(\.user.ini|\.htaccess|\.git|\.env|\.svn|\.project|LICENSE|README.md) {
        return 404;
    }
    location ^~ /.well-known/acme-challenge {
        allow all;
        root /usr/share/nginx/html;
    }
    error_page 404 /404.html;
}
```

---

## æ–¹å¼äºŒï¼šæ‰‹åŠ¨éƒ¨ç½² (åƒå®å¡”ä¸€æ ·)

å¦‚æœä½ ä¸æƒ³ç”¨ Dockerï¼Œæµç¨‹å’Œå®å¡” **å®Œå…¨ä¸€æ ·**ï¼š

1.  ä¸Šä¼ ä»£ç åˆ° `/opt/pickoala/` ä¸‹(æˆ–è€…ä»»æ„ä½ å–œæ¬¢çš„ç›®å½•)ã€‚
2.  **å‰ç«¯**ï¼šå’Œä¸Šé¢ä¸€æ ·ï¼Œå»ºä¸€ä¸ªé™æ€ç½‘ç«™æŒ‡å‘ `dist`ã€‚
3.  **åç«¯**ï¼š
    *   ä½ éœ€è¦è‡ªå·± SSH è¿›æœåŠ¡å™¨ã€‚
    *   `apt install python3-venv ...` (è£…ç¯å¢ƒ)ã€‚
    *   `python3 -m venv venv` (å»ºç¯å¢ƒ)ã€‚
    *   `pip install ...` (è£…ä¾èµ–)ã€‚
    *   å†™ä¸€ä¸ª `systemd` æœåŠ¡æ–‡ä»¶ (é…ç½®åŒ BAOTA_DEPLOY.mdï¼Œåªéœ€ä¿®æ”¹è·¯å¾„)ã€‚

**ç»“è®º**ï¼šç”¨ 1Panel å°±ç”¨ Dockerï¼Œçœå¿ƒï¼
